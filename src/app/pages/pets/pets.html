<section class="pets-page">
  <header class="pets-head">
    <div>
      <h1 class="pets-title">Pets</h1>
      <p class="pets-subtitle">Encontre um pet usando filtros por espécie e status.</p>
    </div>

    <button *ngIf="isAdmin()" mat-flat-button class="btn-new"routerLink="/pets/novo">
      <mat-icon>add</mat-icon>
      Novo Pet
    </button>
  </header>

  <div class="filters">
    <mat-form-field appearance="outline" class="filters__search">
      <mat-icon matPrefix>search</mat-icon>
      <input
        matInput
        placeholder="Buscar por nome ou raça..."
        [value]="search()"
        (input)="onSearchInput($event)"
      />
    </mat-form-field>

    <mat-form-field appearance="outline" class="filters__species">
      <mat-icon matPrefix>pets</mat-icon>
      <mat-select [value]="species()" (selectionChange)="species.set($event.value)">
        <mat-option value="ALL">Todas espécies</mat-option>
        <mat-option value="Cachorro">Cachorro</mat-option>
        <mat-option value="Gato">Gato</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-button-toggle-group
      class="filters__view"
      [value]="viewMode()"
      (change)="viewMode.set($event.value)"
      aria-label="Visualização"
    >
      <mat-button-toggle value="grid" aria-label="Grid">
        <mat-icon>grid_view</mat-icon>
      </mat-button-toggle>
      <mat-button-toggle value="list" aria-label="Lista">
        <mat-icon>view_list</mat-icon>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <mat-tab-group class="status-tabs" (selectedIndexChange)="setTab($event)">
    <mat-tab label="Todos"></mat-tab>
    <mat-tab label="Disponíveis"></mat-tab>
    <mat-tab label="Adotados"></mat-tab>
  </mat-tab-group>

  <div class="mini">
    <div class="mini__card">
      <div class="mini__label">Disponíveis</div>
      <div class="mini__value">{{ availableCount() }}</div>
    </div>

    <div class="mini__card">
      <div class="mini__label">Adotados</div>
      <div class="mini__value">{{ adoptedCount() }}</div>
    </div>

    <div class="mini__card">
      <div class="mini__label">Resultados</div>
      <div class="mini__value">{{ resultsCount() }}</div>
    </div>
  </div>

  <div class="pets-grid" [class.pets-grid--list]="viewMode() === 'list'">
    @for (pet of paged(); track pet.id) {
      <mat-card class="pet">
        <div class="pet__media">
          <img class="pet__img" [src]="pet.image" [alt]="pet.name" />

          <div class="pet__status" [class.pet__status--adopted]="pet.status === 'ADOTADO'">
            <mat-icon>{{ pet.status === 'ADOTADO' ? 'verified' : 'check_circle' }}</mat-icon>
            <span>{{ pet.status === 'ADOTADO' ? 'Adotado' : 'Disponível' }}</span>
          </div>

          <button class="pet__fav" mat-icon-button type="button" (click)="toggleFav(pet.id)">
            <mat-icon>{{ pet.isFav ? 'favorite' : 'favorite_border' }}</mat-icon>
          </button>
        </div>

        <div class="pet__body">
          <div class="pet__title">{{ pet.name }}</div>
          <div class="pet__meta">{{ pet.breed }}</div>

          <div class="pet__info">
            <span><mat-icon>cake</mat-icon> {{ pet.age }}</span>
            <span
              ><mat-icon>{{ pet.gender === 'Macho' ? 'male' : 'female' }}</mat-icon>
              {{ pet.gender }}</span
            >
            <span><mat-icon>pets</mat-icon> Porte {{ pet.size }}</span>
          </div>

          <div class="pet__actions">
            <button mat-button class="pet__details" [routerLink]="['/pets', pet.id]">
              <mat-icon>visibility</mat-icon>
              Ver detalhes
            </button>

            @if (pet.status === 'DISPONIVEL') {
              <button mat-flat-button (click)="adopt(pet.id)" [disabled]="adoptingId() === pet.id">
                <mat-icon>favorite</mat-icon>
                Adotar
              </button>
            }
          </div>
        </div>
      </mat-card>
    }
  </div>

  <mat-paginator
    class="pager"
    [length]="resultsCount()"
    [pageIndex]="pageIndex()"
    [pageSize]="pageSize()"
    [pageSizeOptions]="[6, 9, 12, 18]"
    (page)="onPage($event)"
  >
  </mat-paginator>
</section>
