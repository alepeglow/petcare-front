<section class="pd" *ngIf="pet() as p; else notFound">
  <div class="pd__crumbs">
    <a routerLink="/pets">Pets</a>
    <span>‚Ä∫</span>
    <span>Detalhes do Pet</span>
  </div>

  <div class="pd__grid">
    <!-- COL ESQUERDA -->
    <mat-card class="pd__left">
      <div class="pd__imgWrap">
        <img class="pd__img" [src]="p.image" [alt]="p.name" />
        <span class="pd__chip" [class.pd__chip--adopted]="p.status === 'ADOTADO'">
          <mat-icon>{{ p.status === 'ADOTADO' ? 'verified' : 'check_circle' }}</mat-icon>
          {{ p.status === 'ADOTADO' ? 'Adotado' : 'Dispon√≠vel' }}
        </span>
      </div>

      <h2 class="pd__name">{{ p.name }}</h2>

      <div class="pd__speciesLine">
        <mat-icon class="pd__speciesIcon">pets</mat-icon>
        <span class="pd__speciesText">{{ p.species }}</span>
      </div>

      <!-- LISTA -->
      <div class="pd__list">
        <div class="pd__row">
          <div class="pd__ico"><mat-icon>biotech</mat-icon></div>
          <div class="pd__rowText">
            <div class="pd__rowLabel">Ra√ßa</div>
            <div class="pd__rowValue">{{ p.breed }}</div>
          </div>
        </div>

        <div class="pd__row">
          <div class="pd__ico"><mat-icon>cake</mat-icon></div>
          <div class="pd__rowText">
            <div class="pd__rowLabel">Idade</div>
            <div class="pd__rowValue">{{ p.age }}</div>
          </div>
        </div>

        <div class="pd__row">
          <div class="pd__ico"><mat-icon>event</mat-icon></div>
          <div class="pd__rowText">
            <div class="pd__rowLabel">Data de Entrada</div>
            <div class="pd__rowValue">{{ p.entryDate }}</div>
          </div>
        </div>

        <div class="pd__row">
          <div class="pd__ico"><mat-icon>monitor_weight</mat-icon></div>
          <div class="pd__rowText">
            <div class="pd__rowLabel">Peso</div>
            <div class="pd__rowValue">{{ p.weightKg }} kg</div>
          </div>
        </div>

        <div class="pd__row">
          <div class="pd__ico"><mat-icon>palette</mat-icon></div>
          <div class="pd__rowText">
            <div class="pd__rowLabel">Cor</div>
            <div class="pd__rowValue">{{ p.color }}</div>
          </div>
        </div>

        <div class="pd__row">
          <div class="pd__ico">
            <mat-icon>{{ p.gender === 'Macho' ? 'male' : 'female' }}</mat-icon>
          </div>
          <div class="pd__rowText">
            <div class="pd__rowLabel">Sexo</div>
            <div class="pd__rowValue">{{ p.gender }}</div>
          </div>
        </div>
      </div>

      <!-- Caracter√≠sticas -->
      <mat-card class="pd__box">
        <h3 class="pd__boxTitle">Caracter√≠sticas</h3>
        <mat-chip-set class="pd__chips">
          @for (t of p.traits; track t) {
            <mat-chip>{{ t }}</mat-chip>
          }
        </mat-chip-set>
      </mat-card>

      <!-- A√ß√µes r√°pidas (ADMIN) -->
      <mat-card class="pd__box" *ngIf="isAdmin()">
        <h3 class="pd__boxTitle">A√ß√µes R√°pidas</h3>

        <div class="pd__adminBtns">
          <button mat-stroked-button type="button" (click)="editPet()">
            <mat-icon>edit</mat-icon>
            Editar Dados Cadastrais
          </button>

          <button mat-stroked-button color="warn" type="button" (click)="deletePet()">
            <mat-icon>delete</mat-icon>
            Deletar Pet
          </button>
        </div>
      </mat-card>
    </mat-card>

    <!-- COL DIREITA -->
    <mat-card class="pd__right">
      <!-- Tabs -->
      <div class="pdR__tabs">
        <button class="pdR__tab" type="button" [class.pdR__tab--active]="tab() === 'adocao'" (click)="setTab('adocao')">
          <mat-icon>favorite</mat-icon>
          Ado√ß√£o
        </button>

        <button class="pdR__tab" type="button" [class.pdR__tab--active]="tab() === 'historico'" (click)="setTab('historico')">
          <mat-icon>history</mat-icon>
          Hist√≥rico
        </button>

        <button class="pdR__tab" type="button" [class.pdR__tab--active]="tab() === 'cuidados'" (click)="setTab('cuidados')">
          <mat-icon>medical_services</mat-icon>
          Cuidados
        </button>
      </div>

      <!-- ================= ABA: ADO√á√ÉO ================= -->
      <div *ngIf="tab() === 'adocao'">
        <div class="pdR__hero">
          <div class="pdR__heroIcon" [class.pdR__heroIcon--adopted]="p.status === 'ADOTADO'">
            <mat-icon>{{ p.status === 'ADOTADO' ? 'verified' : 'check_circle' }}</mat-icon>
          </div>

          <div class="pdR__heroText">
            <h3 class="pdR__title">Status Atual</h3>
            <p class="pdR__subtitle">Este pet est√° {{ p.status === 'ADOTADO' ? 'adotado' : 'dispon√≠vel para ado√ß√£o' }}.</p>
          </div>
        </div>

        <div class="pdR__panel">
          <div class="pdR__grid">
            <div class="pdR__cell">
              <div class="pdR__label">Status</div>
              <div class="pdR__value pdR__statusLine">
                <span class="pdR__dot" [class.pdR__dot--adopted]="p.status === 'ADOTADO'"></span>
                {{ statusLongLabel() }}
              </div>
            </div>

            <div class="pdR__cell">
              <div class="pdR__label">Tempo no Abrigo</div>
              <div class="pdR__value">{{ meta()?.tempoNoAbrigo || '‚Äî' }}</div>
            </div>

            <div class="pdR__cell">
              <div class="pdR__label">Total de Ado√ß√µes</div>
              <div class="pdR__value">{{ meta()?.totalAdocoes ?? '‚Äî' }}</div>
            </div>

            <div class="pdR__cell">
              <div class="pdR__label">√öltima Atualiza√ß√£o</div>
              <div class="pdR__value">{{ ultimaAtualizacao() }}</div>
            </div>
          </div>
        </div>

        <div class="pdR__infoBox">
          <div class="pdR__infoIcon"><mat-icon>info</mat-icon></div>
          <div class="pdR__infoText">
            <div class="pdR__infoTitle">Informa√ß√µes Importantes</div>
            <p class="pdR__infoDesc">
              {{ meta()?.infoImportante || 'Ao adotar, voc√™ se compromete com os cuidados e bem-estar do pet.' }}
            </p>
          </div>
        </div>

        <button mat-flat-button class="pdR__cta" type="button" [disabled]="p.status === 'ADOTADO'" (click)="goToAdopt()">
          <mat-icon>favorite</mat-icon>
          Adotar {{ p.name }}
        </button>
      </div>

      <!-- ================= ABA: HIST√ìRICO ================= -->
      <div *ngIf="tab() === 'historico'" class="pdH">
        <div class="pdH__stats">
          <div class="pdH__statCard">
            <div>
              <div class="pdH__statLabel">Total de Eventos</div>
              <div class="pdH__statValue">{{ totalEvents() }}</div>
            </div>
            <div class="pdH__statIcon"><mat-icon>format_list_bulleted</mat-icon></div>
          </div>

          <div class="pdH__statCard pdH__statCard--blue">
            <div>
              <div class="pdH__statLabel">√öltimo Evento</div>
              <div class="pdH__statValue">{{ lastEvent() }}</div>
            </div>
            <div class="pdH__statIcon pdH__statIcon--blue"><mat-icon>schedule</mat-icon></div>
          </div>

          <div class="pdH__statCard pdH__statCard--health">
            <div>
              <div class="pdH__statLabel">Sa√∫de Atual</div>
              <div class="pdH__statValue">{{ healthStatus() }}</div>
            </div>
            <div class="pdH__statIcon pdH__statIcon--health"><mat-icon>verified</mat-icon></div>
          </div>
        </div>

        <div class="pdH__filters">
          <div class="pdH__filtersLabel">Filtrar por:</div>

          <div class="pdH__filterBtns">
            <button type="button" class="pdH__pill" [class.pdH__pill--active]="historyFilter() === 'Todos'" (click)="setHistoryFilter('Todos')">
              Todos
            </button>

            @for (c of historyCategories; track c) {
              <button type="button" class="pdH__pill" [class.pdH__pill--active]="historyFilter() === c" (click)="setHistoryFilter(c)">
                {{ c }}
              </button>
            }
          </div>
        </div>

        <div class="pdH__timeline" *ngIf="filteredHistory().length > 0; else emptyHistory">
          @for (ev of filteredHistory(); track ev.id) {
            <div class="pdH__item">
              <div class="pdH__rail">
                <div class="pdH__iconCircle" [class]="'pdH__iconCircle--' + categoryClass(ev.category)">
                  <mat-icon>{{ ev.icon }}</mat-icon>
                </div>
                <div class="pdH__line"></div>
              </div>

              <div class="pdH__card">
                <div class="pdH__cardHead">
                  <div class="pdH__titleWrap">
                    <div class="pdH__title">{{ ev.title }}</div>
                    <div class="pdH__date">{{ ev.dateTime }}</div>
                  </div>

                  <span class="pdH__badge" [class]="'pdH__badge--' + categoryClass(ev.category)">
                    {{ ev.category }}
                  </span>
                </div>

                <div class="pdH__desc">{{ ev.description }}</div>
              </div>
            </div>
          }
        </div>

        <ng-template #emptyHistory>
          <div class="pdH__empty">Nenhum evento encontrado para esse filtro.</div>
        </ng-template>
      </div>

      <!-- ================= ABA: CUIDADOS ================= -->
      <div *ngIf="tab() === 'cuidados'" class="pdC">
        <div class="pdC__stats">
          <div class="pdC__statCard">
            <div>
              <div class="pdC__statLabel">Total de Cuidados</div>
              <div class="pdC__statValue">{{ totalCare() }}</div>
            </div>
            <div class="pdC__statIcon"><mat-icon>event_note</mat-icon></div>
          </div>

          <div class="pdC__statCard pdC__statCard--blue">
            <div>
              <div class="pdC__statLabel">√öltimo Cuidado</div>
              <div class="pdC__statValue">{{ lastCare() }}</div>
            </div>
            <div class="pdC__statIcon pdC__statIcon--blue"><mat-icon>schedule</mat-icon></div>
          </div>
        </div>

        <div class="pdC__filters">
          <div class="pdC__filtersLabel">Filtrar por:</div>

          <div class="pdC__filterBtns">
            <button type="button" class="pdC__pill" [class.pdC__pill--active]="careFilter() === 'Todos'" (click)="setCareFilter('Todos')">
              Todos
            </button>

            @for (t of careTypes(); track t) {
              <button type="button" class="pdC__pill" [class.pdC__pill--active]="careFilter() === t" (click)="setCareFilter(t)">
                {{ carePillLabel(t) }}
              </button>
            }
          </div>
        </div>

        <div class="pdC__list" *ngIf="filteredCare().length > 0; else emptyCare">
          @for (c of filteredCare(); track c.id) {
            <div class="pdC__item">
              <div class="pdC__leftIcon" [class]="'pdC__leftIcon--' + careBadgeClass(c.type)">
                <mat-icon>{{ c.icon }}</mat-icon>
              </div>

              <div class="pdC__main">
                <div class="pdC__top">
                  <div class="pdC__type">{{ carePillLabel(c.type) }}</div>
                  <span class="pdC__badge" [class]="'pdC__badge--' + careBadgeClass(c.type)">{{ carePillLabel(c.type) }}</span>
                </div>

                <div class="pdC__desc" *ngIf="c.description">{{ c.description }}</div>
                <div class="pdC__date">{{ c.date }}</div>
              </div>
            </div>
          }
        </div>

        <ng-template #emptyCare>
          <div class="pdC__empty">Nenhum cuidado encontrado para esse filtro.</div>
        </ng-template>
      </div>
    </mat-card>
  </div>
</section>

<ng-template #notFound>
  <section class="pd pd--empty">
    <h2>Pet n√£o encontrado üòø</h2>
    <button mat-stroked-button routerLink="/pets">
      <mat-icon>arrow_back</mat-icon>
      Voltar para Pets
    </button>
  </section>
</ng-template>
